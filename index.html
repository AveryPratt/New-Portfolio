<html>
    <head>
        <title>Avery Pratt - Full Stack Developer</title>
        <link rel="stylesheet" type="text/css" href="css/reset.css">
        <link rel="stylesheet" type="text/css" href="css/index.css">
    </head>
    <body>
        <header>
            <nav id="top-nav">
            </nav>
        </header>
        <canvas id="background-canvas"></canvas>
    </body>
    <script src="http://threejs.org/build/three.min.js"></script>
    <script type="x-shader/x-vertex" id="skyVertex">
        uniform vec3 sunPos;
        varying vec3 skyPos;

        void main()
        {
            skyPos = position;
            vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
            gl_Position = projectionMatrix * modelViewPosition;
        }
    </script>
    <script type="x-shader/x-fragment" id="skyFragment">
        uniform vec3 sunPos;
        varying vec3 skyPos;

        float getAtmo(float y)
        {
            float min = 0.1;
            float max = 0.5;
            return min + pow((500.0 - y) / (500.0 / pow(max - min, 0.5)), 2.0);
        }

        void main()
        {
            float sunY = sunPos.y + 500.0;
            float sunX = sunPos.x - 150.0;
            float sunDist = sqrt(pow((skyPos.x - sunX), 2.0) + pow(skyPos.y - sunY, 2.0));
            float sunAtm = getAtmo(sunY);
            float atm = getAtmo(skyPos.y);

            float r = 1.0 - pow(sunAtm, 4.0);
            float g = 1.0 - pow(sunAtm, 3.0);
            float b = 1.0 - pow(sunAtm, 2.0);

            if (sunDist > 5.0)
            {
                r -= pow(sunDist / 5000.0, 1.0 / 4.0);
                g -= pow(sunDist / 5000.0, 1.0 / 3.0);
                b -= pow(sunDist / 5000.0, 1.0 / 2.0);
            }
            
            r *= 1.0 + atm;
            b *= 1.0 + atm;
            g *= 1.0 + atm;

            // adds mist
            r += (1.0 - r) * atm;
            g += (1.0 - g) * atm;
            b += (1.0 - b) * atm;

            gl_FragColor = vec4(r, g, b, 1.0);
        }
    </script>
    <script type="x-shader/x-vertex" id="waterVertex">
        varying vec3 waterPos;

        void main()
        {
            waterPos = position;
            vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
            gl_Position = projectionMatrix * modelViewPosition;
        }
    </script>
    <script type="x-shader/x-fragment" id="waterFragment">
        varying vec3 waterPos;

        void main()
        {
            float cubedHeight = (2.75 + waterPos.z) * (2.75 + waterPos.z) * (2.75 + waterPos.z);
            float r = 0.25 * cubedHeight;
            float g = 0.625 + 0.125 * cubedHeight;
            float b = 0.75 + 0.125 * cubedHeight;
            gl_FragColor = vec4(r, g, b, 0.75);
        }
    </script>
    <script type="x-shader/x-vertex" id="sandVertex">
        varying vec3 sandPos;

        void main()
        {
            sandPos = position;
            vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
            gl_Position = projectionMatrix * modelViewPosition;
        }
    </script>
    <script type="x-shader/x-fragment" id="sandFragment">
        varying vec3 sandPos;

        void main()
        {
            float r = sandPos.y * 0.065 + 0.9;
            float g = sandPos.y * 0.065 + 0.65;
            float b = sandPos.y * 0.065 + 0.4;
            gl_FragColor = vec4(r, g, b, 0.75);
        }
    </script>
    <script src="js/index.js"></script>
    <script src="js/island.js"></script>
    <script src="js/iceberg.js"></script>
</html>